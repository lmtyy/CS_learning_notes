å¥½çš„ï¼æˆ‘æ¥è¯¦ç»†è®²è®² `useEffect` è¿™ä¸ªéå¸¸é‡è¦çš„ Hookã€‚

## useEffect æ˜¯ä»€ä¹ˆï¼Ÿ

`useEffect` æ˜¯ç”¨æ¥**å¤„ç†"å‰¯ä½œç”¨"çš„ Hook**ã€‚æ‰€è°“"å‰¯ä½œç”¨"ï¼Œå°±æ˜¯é‚£äº›ä¼šå½±å“ç»„ä»¶å¤–éƒ¨ä¸–ç•Œçš„æ“ä½œã€‚

**å¸¸è§çš„å‰¯ä½œç”¨ï¼š**
- æ•°æ®è·å–
- è®¢é˜…äº‹ä»¶
- ä¿®æ”¹ DOM
- è®¾ç½®å®šæ—¶å™¨

## åŸºæœ¬è¯­æ³•

```jsx
useEffect(() => {
  // è¿™é‡Œå†™å‰¯ä½œç”¨ä»£ç 
  
  return () => {
    // å¯é€‰ï¼šæ¸…ç†å‡½æ•°
  };
}, [dependency1, dependency2]); // ä¾èµ–æ•°ç»„
```

## ä¸‰ç§ä½¿ç”¨æ–¹å¼

### 1. æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  // æ²¡æœ‰ä¾èµ–æ•°ç»„ - æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ
  useEffect(() => {
    console.log('ç»„ä»¶æ¸²æŸ“å®Œæˆäº†');
  }); // æ³¨æ„ï¼šæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        ç‚¹å‡»
      </button>
    </div>
  );
}
```

**æ¯æ¬¡ç‚¹å‡»æŒ‰é’®éƒ½ä¼šè¾“å‡ºï¼š**
```
ç»„ä»¶æ¸²æŸ“å®Œæˆäº†
```

### 2. åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡

```jsx
function UserProfile() {
  const [user, setUser] = useState(null);

  // ç©ºä¾èµ–æ•°ç»„ - åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  useEffect(() => {
    console.log('ç»„ä»¶ç¬¬ä¸€æ¬¡æ˜¾ç¤ºï¼Œå¼€å§‹è·å–ç”¨æˆ·æ•°æ®');
    
    // æ¨¡æ‹Ÿæ•°æ®è·å–
    setTimeout(() => {
      setUser({ name: 'å¼ ä¸‰', age: 25 });
    }, 1000);
  }, []); // ç©ºæ•°ç»„

  return (
    <div>
      {user ? (
        <p>æ¬¢è¿, {user.name}</p>
      ) : (
        <p>åŠ è½½ä¸­...</p>
      )}
    </div>
  );
}
```

**åªä¼šè¾“å‡ºä¸€æ¬¡ï¼š**
```
ç»„ä»¶ç¬¬ä¸€æ¬¡æ˜¾ç¤ºï¼Œå¼€å§‹è·å–ç”¨æˆ·æ•°æ®
```

### 3. åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œ

```jsx
function SearchResults({ query }) {
  const [results, setResults] = useState([]);

  // å½“ query å˜åŒ–æ—¶æ‰§è¡Œ
  useEffect(() => {
    console.log(`æœç´¢å…³é”®è¯å˜ä¸º: "${query}"`);
    
    // æ ¹æ®å…³é”®è¯æœç´¢
    fetchResults(query).then(data => {
      setResults(data);
    });
  }, [query]); // ä¾èµ– query

  return (
    <div>
      <h3>æœç´¢ç»“æœ: {query}</h3>
      {results.map(item => (
        <div key={item.id}>{item.title}</div>
      ))}
    </div>
  );
}
```

## ==æ¸…ç†å‡½æ•°ï¼ˆCleanupï¼‰==

æœ‰äº›å‰¯ä½œç”¨éœ€è¦æ¸…ç†ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€æ¸…é™¤å®šæ—¶å™¨ã€‚

### æ¸…é™¤å®šæ—¶å™¨ä¾‹å­

```jsx
function Timer() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    console.log('å¯åŠ¨å®šæ—¶å™¨');
    
    const interval = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);

    // æ¸…ç†å‡½æ•° - åœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ
    return () => {
      console.log('æ¸…é™¤å®šæ—¶å™¨');
      clearInterval(interval);
    };
  }, []); // ç©ºæ•°ç»„ï¼Œåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œ

  return <div>è¿è¡Œæ—¶é—´: {seconds} ç§’</div>;
}
```

### äº‹ä»¶ç›‘å¬ä¾‹å­

```jsx
function WindowSize() {
  const [width, setWidth] = useState(window.innerWidth);

  useEffect(() => {
    console.log('å¼€å§‹ç›‘å¬çª—å£å¤§å°å˜åŒ–');
    
    const handleResize = () => {
      setWidth(window.innerWidth);
    };

    window.addEventListener('resize', handleResize);

    // æ¸…ç†å‡½æ•° - ç§»é™¤äº‹ä»¶ç›‘å¬
    return () => {
      console.log('ç§»é™¤çª—å£å¤§å°ç›‘å¬');
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  return <div>çª—å£å®½åº¦: {width}px</div>;
}
```

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ•°æ®è·å–

```jsx
function ProductList({ categoryId }) {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // å½“åˆ†ç±»IDå˜åŒ–æ—¶é‡æ–°è·å–æ•°æ®
    const fetchProducts = async () => {
      setLoading(true);
      try {
        const response = await fetch(`/api/products?category=${categoryId}`);
        const data = await response.json();
        setProducts(data);
      } catch (error) {
        console.error('è·å–æ•°æ®å¤±è´¥:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchProducts();
  }, [categoryId]); // ä¾èµ– categoryId

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div>
      {products.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  );
}
```

### åœºæ™¯2ï¼šæ–‡æ¡£æ ‡é¢˜æ›´æ–°

```jsx
function TaskManager() {
  const [tasks, setTasks] = useState([]);
  const [uncompletedCount, setUncompletedCount] = useState(0);

  // è®¡ç®—æœªå®Œæˆä»»åŠ¡æ•°é‡
  useEffect(() => {
    const count = tasks.filter(task => !task.completed).length;
    setUncompletedCount(count);
  }, [tasks]);

  // æ›´æ–°æ–‡æ¡£æ ‡é¢˜
  useEffect(() => {
    document.title = `å¾…åŠäº‹é¡¹ (${uncompletedCount} ä¸ªæœªå®Œæˆ)`;
  }, [uncompletedCount]); // ä¾èµ–æœªå®Œæˆæ•°é‡

  return (
    <div>
      <p>æœªå®Œæˆä»»åŠ¡: {uncompletedCount} ä¸ª</p>
      {/* ä»»åŠ¡åˆ—è¡¨ç•Œé¢ */}
    </div>
  );
}
```

### åœºæ™¯3ï¼šå¤šä¸ª useEffect ç»„åˆä½¿ç”¨

```jsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  const [isOnline, setIsOnline] = useState(false);

  // 1. è¿æ¥èŠå¤©å®¤
  useEffect(() => {
    console.log(`è¿æ¥åˆ°æˆ¿é—´: ${roomId}`);
    connectToRoom(roomId);
    
    return () => {
      console.log(`æ–­å¼€æˆ¿é—´è¿æ¥: ${roomId}`);
      disconnectFromRoom(roomId);
    };
  }, [roomId]);

  // 2. ç›‘å¬ç½‘ç»œçŠ¶æ€
  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  return (
    <div>
      <p>æˆ¿é—´: {roomId} {isOnline ? 'ğŸŸ¢' : 'ğŸ”´'}</p>
      {/* èŠå¤©ç•Œé¢ */}
    </div>
  );
}
```

## å¸¸è§é”™è¯¯å’Œæ³¨æ„äº‹é¡¹

### 1. å¿˜è®°ä¾èµ–é¡¹

```jsx
function Example({ id }) {
  const [data, setData] = useState(null);

  // âŒ é”™è¯¯ï¼šä½¿ç”¨äº† id ä½†æ²¡æœ‰å£°æ˜ä¾èµ–
  useEffect(() => {
    fetchData(id).then(setData);
  }, []); // åº”è¯¥åŒ…å« id

  // âœ… æ­£ç¡®ï¼šå£°æ˜æ‰€æœ‰ä¾èµ–
  useEffect(() => {
    fetchData(id).then(setData);
  }, [id]);
}
```

### 2. æ— é™å¾ªç¯

```jsx
function Example() {
  const [count, setCount] = useState(0);

  // âŒ é”™è¯¯ï¼šæ¯æ¬¡æ‰§è¡Œéƒ½ä¼šæ›´æ–° countï¼Œå¯¼è‡´æ— é™å¾ªç¯
  useEffect(() => {
    setCount(count + 1);
  }, [count]); // ä¾èµ– countï¼Œä½†åˆåœ¨ effect ä¸­æ›´æ–° count

  // âœ… æ­£ç¡®ï¼šåªåœ¨å¿…è¦æ—¶æ›´æ–°
  useEffect(() => {
    if (count < 10) {
      setCount(count + 1);
    }
  }, [count]);
}
```

### 3. ä¸å¿…è¦çš„é‡å¤æ‰§è¡Œ

```jsx
function Example({ user }) {
  const [profile, setProfile] = useState(null);

  // âŒ å¯èƒ½ä¸å¿…è¦ï¼šæ¯æ¬¡ user å¯¹è±¡å˜åŒ–éƒ½ä¼šæ‰§è¡Œ
  useEffect(() => {
    fetchProfile(user.id).then(setProfile);
  }, [user]); // user å¯¹è±¡å¯èƒ½æ¯æ¬¡éƒ½æ˜¯æ–°çš„

  // âœ… æ›´å¥½ï¼šåªä¾èµ–éœ€è¦çš„å±æ€§
  useEffect(() => {
    fetchProfile(user.id).then(setProfile);
  }, [user.id]); // åªä¾èµ– id
}
```

## æ€»ç»“

`useEffect` çš„æ ¸å¿ƒç”¨æ³•ï¼š

1. **æ— ä¾èµ–æ•°ç»„** - æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ
2. **ç©ºä¾èµ–æ•°ç»„** - åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡  
3. **æœ‰ä¾èµ–æ•°ç»„** - ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œ
4. **è¿”å›æ¸…ç†å‡½æ•°** - åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†èµ„æº

è®°ä½ï¼š`useEffect` æ˜¯åœ¨æµè§ˆå™¨å®Œæˆç»˜åˆ¶åè¿è¡Œçš„ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ›´æ–°ã€‚