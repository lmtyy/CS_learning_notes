# `req` 和 `res`：最简单解释

## 一、一句话理解
- **`req`**（请求）：**前端发来的信息包**
- **`res`**（响应）：**你准备发回去的包裹**

---

## 二、`req` 对象（Request - 请求）

**包含了前端发来的所有信息**：

### 1. **基本信息**
```javascript
app.get('/test', (req, res) => {
  console.log(req.method);    // GET 或 POST
  console.log(req.url);       // /test
  console.log(req.path);      // /test
  console.log(req.ip);        // 客户端的IP地址
  console.log(req.headers);   // 所有请求头信息
});
```

### 2. **三种获取数据的方式**

#### 方式一：获取URL参数（`req.params`）
```javascript
// 后端定义：/users/:id
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;  // 获取 :id 的值
  // 访问 /users/123 → req.params.id = "123"
});

// 多个参数
app.get('/users/:userId/posts/:postId', (req, res) => {
  console.log(req.params.userId);   // 用户ID
  console.log(req.params.postId);   // 帖子ID
});
```

#### 方式二：获取查询参数（`req.query`）
```javascript
// 访问：/search?q=苹果&page=2
app.get('/search', (req, res) => {
  const keyword = req.query.q;     // "苹果"
  const page = req.query.page;     // "2"
  const sort = req.query.sort;     // undefined（没传就是undefined）
});
```

#### 方式三：获取请求体数据（`req.body`）
```javascript
// 需要先加中间件
app.use(express.json());  // 解析JSON数据

// 前端用POST发送JSON数据
app.post('/api/login', (req, res) => {
  const username = req.body.username;
  const password = req.body.password;
  
  console.log(username, password);
});
```

---

## 三、`res` 对象（Response - 响应）

**用来给前端发送数据**：

### 1. **发送数据（3种方式）**
```javascript
// 1. 发送JSON（最常用）
app.get('/api/user', (req, res) => {
  res.json({ name: '张三', age: 25 });
});

// 2. 发送文本
app.get('/hello', (req, res) => {
  res.send('你好，世界！');
});

// 3. 发送状态码 + 数据
app.get('/not-found', (req, res) => {
  res.status(404).send('页面不存在');
});
```

### 2. **设置响应头**
```javascript
app.get('/download', (req, res) => {
  // 设置响应头
  res.set('Content-Type', 'application/json');
  res.set('X-Custom-Header', 'my-value');
  
  res.json({ message: '下载完成' });
});
```

### 3. **重定向**
```javascript
app.get('/old-page', (req, res) => {
  res.redirect('/new-page');  // 跳转到新页面
});
```

---

## 四、完整例子

### 后端代码
```javascript
const express = require('express');
const app = express();

// 解析JSON数据
app.use(express.json());

// 处理登录
app.post('/api/login', (req, res) => {
  // 1. 从req获取数据
  const { username, password } = req.body;
  
  // 2. 处理逻辑（这里简单判断）
  if (username === 'admin' && password === '123456') {
    // 3. 通过res返回成功
    res.json({
      success: true,
      message: '登录成功',
      token: 'fake-jwt-token-123'
    });
  } else {
    // 4. 通过res返回失败
    res.status(401).json({
      success: false,
      message: '用户名或密码错误'
    });
  }
});

// 获取用户信息
app.get('/api/user/:id', (req, res) => {
  // req.params 获取URL参数
  const userId = req.params.id;
  
  // req.query 获取查询参数
  const details = req.query.details === 'true';
  
  // 模拟数据
  const user = {
    id: userId,
    name: '张三',
    age: 25
  };
  
  // 通过res返回
  res.json({
    success: true,
    data: user
  });
});

app.listen(3000);
```

### 前端测试
```javascript
// 测试登录
fetch('http://localhost:3000/api/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'admin',
    password: '123456'
  })
})
.then(res => res.json())
.then(data => console.log(data));

// 测试获取用户
fetch('http://localhost:3000/api/user/123?details=true')
  .then(res => res.json())
  .then(data => console.log(data));
```

---

## 五、req 和 res 的核心关系

```
前端 → 发送请求 → req（包含所有请求信息）
                     ↓
后端 → 处理请求 → 用req的数据
                     ↓
后端 → 准备响应 → res（设置返回内容）
                     ↓
前端 ← 接收响应 ← res发送的数据
```

### 流程图：
```
1. 前端访问：/api/user/123?details=true
          ↓
2. req 收到：
   - req.params.id = "123"
   - req.query.details = "true"
   - req.method = "GET"
          ↓
3. 后端处理这些数据
          ↓
4. 通过 res.json() 返回结果
          ↓
5. 前端收到JSON数据
```

---

## 六、快速记忆

### req（请求）：
- `req.params` → URL中的 `/users/:id`
- `req.query` → `?name=张三&age=20`
- `req.body` → POST发送的JSON数据
- `req.method` → GET或POST

### res（响应）：
- `res.json(data)` → 返回JSON
- `res.send(text)` → 返回文本
- `res.status(404)` → 设置状态码
- `res.redirect(url)` → 重定向

### 一句话总结：
**`req` 是前端给你的东西，`res` 是你给前端的东西。**

---

## 七、常见操作速查

```javascript
// 1. 获取数据
const id = req.params.id;
const page = req.query.page;
const data = req.body;

// 2. 返回数据
res.json({ success: true, data: [...] });
res.status(200).send('OK');
res.status(404).send('Not Found');

// 3. 组合使用
app.post('/api/users', (req, res) => {
  const userData = req.body;          // 获取数据
  // ...处理...
  res.status(201).json({             // 返回结果
    success: true, 
    user: userData 
  });
});
```

这就是 `req` 和 `res` 的全部核心了！