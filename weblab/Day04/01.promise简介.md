# ğŸ”¥ Promise è¶…ç®€å•è®²è§£ï¼ˆçº¯çœŸå®ä»£ç ï¼‰

## ä¸€å¥è¯è§£é‡Š
**Promise = ä¸€ä¸ªâ€œä¿è¯å•â€**ï¼Œä¿è¯å°†æ¥ä¼šç»™ä½ ç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ã€‚

## ğŸ¯ æœ€æ ¸å¿ƒçš„3ä¸ªçŠ¶æ€
1. **ç­‰å¾…ä¸­ï¼ˆpendingï¼‰**ï¼šè¿˜æ²¡ç»“æœ
2. **æˆåŠŸäº†ï¼ˆfulfilledï¼‰**ï¼šç»™ä½ æƒ³è¦çš„ç»“æœ âœ…
3. **å¤±è´¥äº†ï¼ˆrejectedï¼‰**ï¼šç»™ä¸äº†ä½ ç»“æœ âŒ

## ğŸ’¡ ä¸ºä»€ä¹ˆè¦ç”¨Promiseï¼Ÿ
```javascript
// âŒ å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰
fetch('https://api.example.com/users/1', (user) => {
  fetch(`https://api.example.com/orders/${user.id}`, (orders) => {
    fetch(`https://api.example.com/products/${orders[0].id}`, (product) => {
      console.log(product);
    });
  });
});

// âœ… Promiseé“¾å¼è°ƒç”¨ï¼ˆæ¸…æ™°ï¼ï¼‰
fetch('https://api.example.com/users/1')
  .then(user => fetch(`https://api.example.com/orders/${user.id}`))
  .then(orders => fetch(`https://api.example.com/products/${orders[0].id}`))
  .then(product => console.log(product))
  .catch(error => console.error('å‡ºé”™äº†:', error));
```

## ğŸ” å®é™…ä¾‹å­ï¼šæ¨¡æ‹Ÿç™»å½•
```javascript
// æ¨¡æ‹Ÿç™»å½•API
function login(username, password) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (username === 'admin' && password === '123456') {
        resolve({
          success: true,
          user: { id: 1, name: 'ç®¡ç†å‘˜', token: 'abc123xyz' }
        });
      } else {
        reject({
          success: false,
          message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'
        });
      }
    }, 1500); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
  });
}

// ä½¿ç”¨Promise
login('admin', '123456')
  .then(response => {
    console.log('ç™»å½•æˆåŠŸ:', response.user.name);
    localStorage.setItem('token', response.user.token);
    window.location.href = '/dashboard';
  })
  .catch(error => {
    console.log('ç™»å½•å¤±è´¥:', error.message);
    document.getElementById('error').textContent = error.message;
  })
  .finally(() => {
    // æ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œ
    console.log('ç™»å½•æµç¨‹ç»“æŸ');
  });
```

## ğŸ”§ ä½ åªéœ€è¦ä¼šè¿™3ä¸ªæ–¹æ³•

### 1. **`.then()` - å¤„ç†æˆåŠŸ**
```javascript
fetch('https://jsonplaceholder.typicode.com/users/1')
  .then(response => response.json())
  .then(user => {
    console.log('ç”¨æˆ·ä¿¡æ¯:', user);
    document.getElementById('username').textContent = user.name;
  });
```

### 2. **`.catch()` - å¤„ç†å¤±è´¥**
```javascript
fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log('æ•°æ®:', data))
  .catch(error => {
    console.error('è¯·æ±‚å¤±è´¥:', error);
    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
  });
```

### 3. **`.finally()` - æ€»æ˜¯æ‰§è¡Œ**
```javascript
let loading = true;

fetch('https://api.example.com/products')
  .then(response => response.json())
  .then(products => renderProducts(products))
  .catch(error => showError(error))
  .finally(() => {
    loading = false;
    document.getElementById('loading').style.display = 'none';
  });
```

## ğŸš€ å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨

### åœºæ™¯1ï¼šè·å–å¹¶æ˜¾ç¤ºæ•°æ®
```javascript
// è·å–æ–‡ç« åˆ—è¡¨
fetch('https://jsonplaceholder.typicode.com/posts')
  .then(response => {
    if (!response.ok) {
      throw new Error('ç½‘ç»œå“åº”å¼‚å¸¸');
    }
    return response.json();
  })
  .then(posts => {
    posts.forEach(post => {
      const div = document.createElement('div');
      div.innerHTML = `<h3>${post.title}</h3><p>${post.body}</p>`;
      document.body.appendChild(div);
    });
  })
  .catch(error => {
    console.error('è·å–æ–‡ç« å¤±è´¥:', error);
  });
```

### åœºæ™¯2ï¼šè¡¨å•æäº¤
```javascript
document.getElementById('comment-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = {
    postId: 123,
    content: document.getElementById('comment').value,
    author: 'åŒ¿åç”¨æˆ·'
  };
  
  try {
    const response = await fetch('https://api.example.com/comments', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });
    
    const result = await response.json();
    
    if (result.success) {
      alert('è¯„è®ºæˆåŠŸï¼');
      addCommentToPage(result.data);
      document.getElementById('comment').value = '';
    }
  } catch (error) {
    alert('è¯„è®ºå¤±è´¥ï¼Œè¯·é‡è¯•');
  }
});
```

### åœºæ™¯3ï¼šå¤šä¸ªè¯·æ±‚ä¸€èµ·å‘
```javascript
// åŒæ—¶è·å–ç”¨æˆ·å’Œå•†å“ä¿¡æ¯
Promise.all([
  fetch('https://api.example.com/user/123').then(r => r.json()),
  fetch('https://api.example.com/products').then(r => r.json())
])
.then(([user, products]) => {
  console.log('ç”¨æˆ·:', user);
  console.log('å•†å“æ•°é‡:', products.length);
  renderPage(user, products);
})
.catch(error => {
  console.log('éƒ¨åˆ†æ•°æ®è·å–å¤±è´¥:', error);
});
```

## ğŸ’ª é©¬ä¸Šåœ¨æµè§ˆå™¨ä¸­è¯•è¯•

```javascript
// å¤åˆ¶è¿™æ®µåˆ°æµè§ˆå™¨æ§åˆ¶å°ç«‹å³è¿è¡Œï¼

// 1. åˆ›å»ºä¸€ä¸ªç®€å•çš„Promise
const promise1 = new Promise((resolve, reject) => {
  console.log('Promiseå¼€å§‹æ‰§è¡Œ...');
  setTimeout(() => {
    resolve('2ç§’åå®Œæˆï¼');
  }, 2000);
});

// 2. ä½¿ç”¨å®ƒ
promise1
  .then(result => {
    console.log('æˆåŠŸ:', result);
    return 'ç»§ç»­å¤„ç†...';
  })
  .then(msg => {
    console.log('ç¬¬äºŒæ­¥:', msg);
  })
  .catch(error => {
    console.log('å¤±è´¥:', error);
  })
  .finally(() => {
    console.log('æ‰§è¡Œå®Œæ¯•');
  });

// 3. ç«‹å³çœ‹åˆ°ï¼šPromiseå¼€å§‹æ‰§è¡Œ...
// 4. 2ç§’åçœ‹åˆ°ï¼šæˆåŠŸ: 2ç§’åå®Œæˆï¼
// 5. ç„¶åçœ‹åˆ°ï¼šç¬¬äºŒæ­¥: ç»§ç»­å¤„ç†...
// 6. æœ€åçœ‹åˆ°ï¼šæ‰§è¡Œå®Œæ¯•
```

## ğŸ¯ å…³é”®ç‚¹æ€»ç»“

1. **Promiseç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œ**ï¼ˆç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ç­‰ï¼‰
2. **ä¸‰ç§çŠ¶æ€**ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆæˆåŠŸï¼‰ã€rejectedï¼ˆå¤±è´¥ï¼‰
3. **ç”¨`.then()`å¤„ç†æˆåŠŸçš„ç»“æœ**
4. **ç”¨`.catch()`å¤„ç†å¤±è´¥çš„æƒ…å†µ**
5. **ç”¨`.finally()`æ‰§è¡Œæ¸…ç†å·¥ä½œ**

## ğŸ“š ä¸€å¥è¯è®°ä½
**Promiseå°±æ˜¯JavaScriptä¸­å¤„ç†â€œç¨åå®Œæˆçš„äº‹æƒ…â€çš„æ ‡å‡†æ–¹å¼ã€‚**

---

**æœ€ç®€å•çš„ç†è§£**ï¼š
```javascript
// å¼‚æ­¥æ“ä½œï¼ˆéœ€è¦æ—¶é—´å®Œæˆï¼‰
fetch('æŸä¸ªURL') // â† è¿”å›Promise
  .then(æ•°æ® => console.log(æ•°æ®)) // æˆåŠŸæ—¶
  .catch(é”™è¯¯ => console.log(é”™è¯¯)); // å¤±è´¥æ—¶
```

è¿™æ ·å°±å¤Ÿäº†ï¼90%çš„æƒ…å†µä½ åªéœ€è¦ä¼šç”¨`.then()`å’Œ`.catch()`ã€‚