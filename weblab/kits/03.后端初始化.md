后端初始化和前端一样，不仅仅是建个文件跑起来，而是要建立一个**规范、安全、易于维护**的地基。

作为初学者，你现在用的是 **Express**。在实际工作中，后端初始化的核心在于：**依赖安装**、**项目架构分层**、**环境配置** 以及 **安全性设置**。

下面是标准的 Express 后端初始化流程：

---

### 第一步：创建项目与基础配置

假设你的项目根目录下已经有了 `client` 文件夹，现在我们在根目录创建 `server` 文件夹。

```bash
# 1. 创建并进入文件夹
mkdir server
cd server

# 2. 生成 package.json (直接使用默认配置)
npm init -y
```

### 第二步：安装“四大金刚”

后端开发最基础的几个包，缺一不可：

```bash
npm install express cors dotenv
npm install -D nodemon
```

*   **express**: Web 框架核心。
*   **cors**: 解决跨域问题（Cross-Origin Resource Sharing）。**虽然前端 Vite 配了代理，但生产环境或调试时，后端配置 CORS 是双重保险。**
*   **dotenv**: 用来读取 `.env` 文件。**千万不要把数据库密码、API Key 直接写在代码里**，要用环境变量。
*   **nodemon** (开发依赖): 监听代码变动，保存文件后自动重启服务器，不用每次都手动 `ctrl + c` 再 `node index.js`。

### 第三步：配置启动脚本

打开 `server/package.json`，修改 `scripts` 部分，让启动命令更顺手：

```json
"scripts": {
  "start": "node index.js",       // 生产环境运行 (上线用)
  "dev": "nodemon index.js"       // 开发环境运行 (平时开发用)
}
```
以后你只需要运行 `npm run dev` 就可以愉快地写代码了。

---

### 第四步：构建合理的目录结构 (MVC 模式)

千万不要把几百行代码全写在 `index.js` 里！这是新手最容易犯的错误。

一个标准的 Express 后端结构应该是**分层**的。建议创建以下文件夹：

```
server/
├── config/          # 配置文件 (如数据库连接 db.js)
├── controllers/     # 控制器 (处理业务逻辑，比如“用户登录逻辑”)
├── models/          # 数据模型 (定义数据库表结构，Schema)
├── routes/          # 路由 (定义 URL 路径，如 /api/users)
├── middleware/      # 中间件 (拦截器，如验证 Token、错误处理)
├── .env             # 环境变量 (存机密信息)
├── .gitignore       # Git 忽略文件
└── index.js         # 入口文件
```

你现在可以先创建这些空文件夹。

---

### 第五步：编写入口文件 (index.js)

这是服务器的“大门”。我们需要在这里组装所有零件。

```javascript
// server/index.js
require('dotenv').config(); // 1. 最先引入环境变量
const express = require('express');
const cors = require('cors');

const app = express();
const PORT = process.env.PORT || 3000;

// === 基础中间件配置 ===
// 允许跨域
app.use(cors()); 
// 解析前端传来的 JSON 数据 (必须有这句，否则 req.body 是 undefined)
app.use(express.json()); 
// 如果你需要接收表单数据 (x-www-form-urlencoded)
app.use(express.urlencoded({ extended: true }));

// === 路由配置 ===
// 简单的测试路由
app.get('/', (req, res) => {
  res.send('Server is running!');
});

// 引入模块化路由 (后续步骤会讲)
// const userRoutes = require('./routes/userRoutes');
// app.use('/api/users', userRoutes);

// === 启动服务 ===
app.listen(PORT, () => {
  console.log(`🚀 服务端已启动: http://localhost:${PORT}`);
});
```

---

### 第六步：配置环境变量 (.env)

在 `server` 目录下新建一个文件叫 `.env` (注意文件名前面有个点)。
内容如下：

```env
PORT=3000
# 如果有数据库，也写在这里
MONGO_URI=mongodb://localhost:27017/my_database
JWT_SECRET=my_super_secret_key
```

**同时，非常重要的一步：**
新建 `.gitignore` 文件，一定要把 `.env` 和 `node_modules` 加进去。
**原因**：`.env` 里有你的私钥和密码，提交到 GitHub 上就等于裸奔。

```text
# server/.gitignore
node_modules
.env
```

---

### 第七步：演示“路由”与“控制器”的分离 (核心进阶)

为了让你理解怎么写可维护的代码，我们要把逻辑拆出去。我们以“获取代办列表”为例。

1.  **创建控制器 (Controllers)**
    在 `server/controllers/todoController.js`：
    ```javascript
    // 这里处理具体的逻辑
    const getTodos = (req, res) => {
      // 假设这是从数据库取出的数据
      const todos = [
        { id: 1, text: '学习 React', done: true },
        { id: 2, text: '学习 Express', done: false }
      ];
      // 返回 JSON 给前端
      res.json({
        code: 200,
        data: todos,
        msg: '获取成功'
      });
    };

    module.exports = { getTodos };
    ```

2.  **创建路由 (Routes)**
    在 `server/routes/todoRoutes.js`：
    ```javascript
    const express = require('express');
    const router = express.Router();
    const { getTodos } = require('../controllers/todoController');

    // 定义路径，真正访问的是 /api/todos/list
    router.get('/list', getTodos);

    module.exports = router;
    ```

3.  **在入口文件注册 (index.js)**
    回到 `server/index.js`，添加：
    ```javascript
    const todoRoutes = require('./routes/todoRoutes');

    // 挂载路由
    // 意思就是：所有以 /api/todos 开头的请求，都交给 todoRoutes 处理
    app.use('/api/todos', todoRoutes); 
    ```

---

### 第八步：全局错误处理 (锦上添花)

如果代码报错了，不要让整个服务器挂掉（Crash），也不要直接把报错堆栈返给前端用户看。

在 `index.js` 的 `app.listen` 之前添加：

```javascript
// 全局错误处理中间件 (必须有 4 个参数)
app.use((err, req, res, next) => {
  console.error(err.stack); // 在后台打印错误
  res.status(500).json({ 
    code: 500, 
    msg: '服务器开小差了，请稍后再试' 
  });
});
```

---

### 总结

至此，你的后端初始化完成了：
1.  **npm run dev** 能一键启动且热更新。
2.  **安全**：使用 `.env` 隔离了敏感配置。
3.  **通信流畅**：配置了 `cors` 和 `json` 解析，前端发数据不再报错。
4.  **结构清晰**：`index.js` 只是入口，具体的逻辑拆分到了 `routes` 和 `controllers`。

接下来，你就可以在 `controllers` 里连接数据库，写真正的业务逻辑了！