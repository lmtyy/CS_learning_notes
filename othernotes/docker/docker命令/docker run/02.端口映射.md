好的！`-p` 参数是 `docker run` 命令中**最重要和最常用**的参数之一，我们来详细讲解它。

---

### 一、`-p` 参数的作用

`-p`（全称 `--publish`）用于**端口映射**。

它的核心功能是：**将宿主机的端口映射到容器的内部端口**，使得外部可以通过访问宿主机的端口来访问容器内运行的服务。

**简单比喻：**
- 容器就像公司内网的一台服务器，有内网IP和端口
- `-p` 参数就像在公司路由器上设置端口转发规则
- 外部用户访问公司公网IP的某个端口，请求就会被转发到内网服务器的指定端口

---

### 二、基本语法

```bash
docker run -p <主机端口>:<容器端口> 镜像名称
```

---

### 三、四种使用方式

#### 方式1：指定主机端口和容器端口（最常用）
```bash
# 将主机的 8080 端口映射到容器的 80 端口
docker run -d -p 8080:80 nginx
```
**访问方式：** `http://localhost:8080` 或 `http://主机IP:8080`

#### 方式2：让 Docker 自动选择主机端口
```bash
# Docker 会在主机的 32768-60999 范围内随机选择一个可用端口
docker run -d -p 80 nginx
```
**查看映射关系：**
```bash
docker ps
# 输出类似：0.0.0.0:32768->80/tcp
```

#### 方式3：指定主机IP和端口
```bash
# 只监听主机的 127.0.0.1（本地回环地址）的 8080 端口
docker run -d -p 127.0.0.1:8080:80 nginx
```
**效果：** 只能在本机访问，其他机器无法访问

#### 方式4：指定协议（TCP/UDP）
```bash
# 映射 UDP 端口
docker run -d -p 8080:80/udp nginx

# 同时映射 TCP 和 UDP
docker run -d -p 8080:80/tcp -p 8080:80/udp nginx
```
**默认协议：** TCP

---

### 四、实际应用示例

#### 示例1：运行 Web 服务器
```bash
# 运行 Nginx，通过主机 8080 端口访问
docker run -d --name my-nginx -p 8080:80 nginx

# 运行 Apache，通过主机 8081 端口访问
docker run -d --name my-apache -p 8081:80 httpd
```
现在你可以同时访问：
- `http://localhost:8080` (Nginx)
- `http://localhost:8081` (Apache)

#### 示例2：运行数据库
```bash
# 运行 MySQL，将主机的 3306 端口映射到容器的 3306 端口
docker run -d --name my-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql

# 运行 Redis，将主机的 6379 端口映射到容器的 6379 端口
docker run -d --name my-redis -p 6379:6379 redis
```

#### 示例3：运行多个相同服务的实例
```bash
# 第一个 WordPress 实例
docker run -d --name wordpress1 -p 8080:80 wordpress

# 第二个 WordPress 实例（使用不同端口）
docker run -d --name wordpress2 -p 8081:80 wordpress
```

---

### 五、查看端口映射

#### 1. 使用 `docker ps` 查看
```bash
docker ps
```
输出中的 `PORTS` 列显示端口映射：
```
0.0.0.0:8080->80/tcp
```

#### 2. 使用 `docker port` 查看具体信息
```bash
# 查看指定容器的端口映射
docker port my-nginx
# 输出：80/tcp -> 0.0.0.0:8080
```

---

### 六、重要注意事项

#### 1. 端口冲突
如果主机端口已被占用，会报错：
```bash
# 错误：如果主机的 8080 端口已被其他程序占用
docker: Error response from daemon: driver failed programming external connectivity on endpoint my-nginx: Bind for 0.0.0.0:8080 failed: port is already allocated.
```

**解决方案：** 换一个空闲的主机端口
```bash
docker run -d -p 8081:80 nginx
```

#### 2. 防火墙设置
如果从其他机器无法访问，请检查主机的防火墙设置，确保映射的端口是开放的。

#### 3. 多网卡环境
如果你的主机有多个IP地址，可以使用方式3来指定监听哪个IP的端口。

---

### 七、`-P` 参数（大写P）的对比

`-P`（大写）是自动端口映射：
```bash
# Docker 会自动将容器暴露的所有端口映射到主机的高位随机端口
docker run -d -P nginx
```

**查看映射结果：**
```bash
docker ps
# 输出类似：0.0.0.0:32768->80/tcp
```

**区别总结：**
- `-p`：手动指定端口映射（推荐）
- `-P`：自动端口映射（适合测试）

---

### 总结

`-p` 参数的核心作用就是**打通容器内外的网络通道**，是让容器服务能够被外部访问的关键。

**记住这个万能格式：**
```bash
docker run -p <主机端口>:<容器端口> 镜像名称
```

掌握了 `-p` 参数，你就成功了一大半！