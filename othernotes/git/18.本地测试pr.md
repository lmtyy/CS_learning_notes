我来详细讲解 **本地测试 PR 的方法一：使用 GitHub CLI**，这是目前最简单、最推荐的方法。

## 一、GitHub CLI 简介

**GitHub CLI (`gh`)** 是 GitHub 官方命令行工具，可以让你在终端中直接操作 GitHub，处理 PR 非常方便。

## 二、安装 GitHub CLI

### **macOS**
```bash
# 使用 Homebrew
brew install gh

# 验证安装
gh --version
```

### **Windows**
```bash
# 使用 Winget
winget install --id GitHub.cli

# 或使用 Chocolatey
choco install gh

# 或下载 MSI 安装包：https://cli.github.com/
```

### **Linux**
```bash
# Ubuntu/Debian
sudo apt install gh

# Fedora
sudo dnf install gh

# 或使用包管理器
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh
```

## 三、配置 GitHub CLI

### **首次使用需要登录**
```bash
# 启动认证流程
gh auth login

# 按照提示操作：
# 1. 选择 GitHub.com 或 GitHub Enterprise
# 2. 选择 HTTPS 或 SSH
# 3. 选择浏览器登录或 token 登录
```

### **验证登录状态**
```bash
gh auth status
# 显示类似：
# ✓ 以用户 your-username 身份登录 github.com
# ✓ 凭证：存储在 git credential helper 中
# ✓ Token 作用域：gist, read:org, repo, workflow
```

## 四、使用 GitHub CLI 测试 PR

### **1. 查看仓库的 PR 列表**
```bash
# 进入你的项目目录
cd your-project

# 查看开放的 PR
gh pr list

# 输出示例：
# #123  Fix login bug         username:patch-1
# #124  Add dark mode         anotheruser:feature/dark-mode
# #125  Update documentation  contributor:docs-update

# 查看更多信息
gh pr list --limit 10 --state all
```

### **2. 查看特定 PR 详情**
```bash
# 查看 PR #123 的详细信息
gh pr view 123

# 输出示例：
# 标题：Fix login bug
# 状态：OPEN
# 作者：username
# 标签：bug
# 分支：patch-1 → main
# 审查：1 个审查请求
# 检查：2 个通过，0 个失败
# 
# 当用户名为空时，登录会失败
# 
# 查看 PR 的网页
gh pr view 123 --web
```

### **3. 检出 PR 到本地（核心操作）**
```bash
# 检出 PR #123 到本地分支
gh pr checkout 123

# 输出：
# ✓ 已检出分支 'patch-1'
# 分支 'patch-1' 设置为跟踪 'origin/patch-1'

# 如果你想要自定义本地分支名
gh pr checkout 123 --branch test-fix-login

# 使用 PR URL 直接检出
gh pr checkout https://github.com/owner/repo/pull/123
```

### **4. 测试过程中的常用操作**
```bash
# 查看这个 PR 的提交历史
git log --oneline -5

# 查看与主分支的差异
git diff main...HEAD

# 查看具体文件变更
gh pr diff 123  # 在网页查看
# 或
git show HEAD

# 运行项目测试
npm test
# 或
pytest
# 或
make test
```

### **5. 本地构建和运行**
```bash
# 安装依赖
npm install
# 或
pip install -r requirements.txt

# 构建项目
npm run build

# 启动开发服务器
npm start
# 或
python app.py

# 然后打开浏览器测试功能
```

### **6. 提交测试反馈**
```bash
# 在 PR 上添加评论
gh pr comment 123 --body "测试通过，功能正常！"

# 添加详细测试报告
gh pr comment 123 --body-file test-report.md

# 请求变更（需要修改时）
gh pr review 123 --request-changes --body "需要修复以下问题：..."

# 批准 PR
gh pr review 123 --approve --body "所有测试通过，LGTM！"
```

## 五、实战示例

### **完整测试流程**
```bash
# 步骤 1：进入项目
cd ~/projects/my-app

# 步骤 2：查看有哪些 PR 需要测试
gh pr list
# 发现 PR #256 需要测试

# 步骤 3：查看 PR 详情
gh pr view 256
# 看到是修复用户注册的问题

# 步骤 4：检出到本地
gh pr checkout 256
# ✓ 已检出分支 'fix-user-registration'

# 步骤 5：运行测试套件
npm test
# ✓ 所有 42 个测试通过

# 步骤 6：构建项目
npm run build
# ✓ 构建成功

# 步骤 7：启动服务并手动测试
npm start &
# 打开浏览器测试注册功能
# 测试各种边界情况

# 步骤 8：添加测试反馈
gh pr comment 256 --body "## 测试报告 ✅
- 单元测试全部通过
- 构建成功
- 手动测试了以下场景：
  1. 正常注册 ✓
  2. 邮箱格式验证 ✓
  3. 密码强度检查 ✓
  4. 重复注册处理 ✓

建议：添加手机号验证的测试用例"

# 步骤 9：清理本地分支
git checkout main
git branch -d fix-user-registration
```

## 六、高级技巧

### **批量处理多个 PR**
```bash
# 创建一个测试多个 PR 的脚本
#!/bin/bash
# test-multiple-prs.sh
PR_NUMBERS=(123 124 125)

for pr in "${PR_NUMBERS[@]}"; do
    echo "测试 PR #$pr"
    gh pr checkout $pr
    npm test
    if [ $? -eq 0 ]; then
        echo "PR #$pr 测试通过"
    else
        echo "PR #$pr 测试失败"
    fi
    git checkout main
done
```

### **创建测试环境配置**
```bash
# 创建 .env.test 文件
cp .env.example .env.test
# 修改为测试配置

# 运行特定环境的测试
NODE_ENV=test npm test
```

### **使用别名简化命令**
```bash
# 在 ~/.zshrc 或 ~/.bashrc 中添加
alias prlist='gh pr list --limit 20'
alias prview='gh pr view'
alias prtest='gh pr checkout $1 && npm test && git checkout main'
alias prcheck='gh pr checkout'

# 使用
prlist
prtest 123
```

## 七、常见问题解决

### **1. 权限不足**
```bash
# 重新登录
gh auth logout
gh auth login

# 检查 token 权限
# 需要 repo 权限才能 checkout PR
```

### **2. 冲突无法检出**
```bash
# 先更新本地主分支
git checkout main
git pull origin main

# 再尝试检出 PR
gh pr checkout 123

# 如果仍有冲突，手动合并
gh pr checkout 123 --branch temp-branch
git merge main
# 解决冲突后继续测试
```

### **3. PR 来自 fork 仓库**
```bash
# GitHub CLI 自动处理 fork 的 PR
gh pr checkout 123
# 会自动设置正确的远程跟踪
```

## 八、优势总结

使用 GitHub CLI 的优势：
1. **简单直观**：一条命令完成检出
2. **自动配置**：自动设置远程跟踪分支
3. **跨平台**：Windows/macOS/Linux 都支持
4. **功能完整**：不仅 checkout，还能 review、comment 等
5. **官方维护**：与 GitHub 功能同步更新

## 九、替代命令对比

```bash
# GitHub CLI（推荐）
gh pr checkout 123

# 传统方法（复杂）
git fetch origin pull/123/head:pr-123
git checkout pr-123
git branch -u origin/pr-123

# 可以看到 GitHub CLI 大大简化了流程
```

## 十、最佳实践

1. **始终保持主分支更新**
   ```bash
   git checkout main
   git pull origin main
   ```

2. **测试完成后清理分支**
   ```bash
   git checkout main
   git branch -D pr-branch-name
   ```

3. **记录测试过程**
   ```bash
   # 创建测试笔记
   gh pr comment 123 --body-file test-notes.md
   ```

4. **使用自动化测试脚本**
   ```bash
   # 创建 test-pr.sh 脚本复用
   ./test-pr.sh 123
   ```

这种方法适合大多数开发者的工作流，特别是经常需要审查和测试 PR 的团队协作场景。