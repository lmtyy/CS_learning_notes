好的，我来详细讲解一下 Google Truth 测试框架。

## 什么是 Google Truth？

Google Truth 是 Google 开发的一个流畅的断言库，旨在提供更可读、更自然的测试断言语法。它是 JUnit 断言和 AssertJ 的替代品，特别适合与 Google 的其他工具（如 Guava）配合使用。

## 核心特性

### 1. 流畅的链式调用
```java
assertThat(lld1.toList()).containsExactly("front", "middle", "back").inOrder();
```

### 2. 丰富的断言方法
```java
// 集合断言
assertThat(collection).contains(element);
assertThat(collection).containsExactly(e1, e2, e3).inOrder();
assertThat(collection).isEmpty();

// 字符串断言  
assertThat(string).contains("substring");
assertThat(string).startsWith("prefix");
assertThat(string).endsWith("suffix");

// 数值断言
assertThat(number).isGreaterThan(5);
assertThat(number).isLessThan(10);
assertThat(number).isWithin(0.5).of(3.14);
```

## 常用断言方法详解

### 集合相关断言
```java
@Test
public void testCollectionAssertions() {
    List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
    
    // 检查包含元素
    assertThat(names).contains("Bob");
    assertThat(names).containsAnyOf("Bob", "David");
    
    // 精确匹配（顺序敏感）
    assertThat(names).containsExactly("Alice", "Bob", "Charlie").inOrder();
    
    // 精确匹配（顺序不敏感）
    assertThat(names).containsExactly("Charlie", "Alice", "Bob");
    
    // 检查为空
    assertThat(new ArrayList<>()).isEmpty();
}
```

### 字符串断言
```java
@Test
public void testStringAssertions() {
    String text = "Hello World";
    
    assertThat(text).startsWith("Hello");
    assertThat(text).endsWith("World");
    assertThat(text).contains("llo W");
    assertThat(text).hasLength(11);
    assertThat(text).matches("^Hello.*World$");
}
```

### 数值断言
```java
@Test
public void testNumberAssertions() {
    int number = 42;
    double pi = 3.14159;
    
    assertThat(number).isEqualTo(42);
    assertThat(number).isGreaterThan(40);
    assertThat(number).isLessThan(50);
    assertThat(pi).isWithin(0.01).of(3.14);
}
```

### 自定义错误消息
```java
@Test
public void testWithCustomMessage() {
    Deque61B<String> lld = new LinkedListDeque61B<>();
    lld.addFirst("test");
    
    assertWithMessage("Deque should contain exactly one element")
        .that(lld.toList())
        .containsExactly("test");
}
```

## 与 JUnit 断言的对比

### JUnit 风格
```java
import static org.junit.jupiter.api.Assertions.*;

@Test
public void testJUnitStyle() {
    List<String> list = Arrays.asList("a", "b", "c");
    
    assertEquals(3, list.size());
    assertTrue(list.contains("a"));
    assertArrayEquals(new String[]{"a", "b", "c"}, list.toArray());
}
```

### Truth 风格
```java
import static com.google.common.truth.Truth.assertThat;

@Test
public void testTruthStyle() {
    List<String> list = Arrays.asList("a", "b", "c");
    
    assertThat(list).hasSize(3);
    assertThat(list).contains("a");
    assertThat(list).containsExactly("a", "b", "c").inOrder();
}
```

## 为什么选择 Truth？

### 优点：
1. **更好的可读性** - 读起来像自然语言
2. **更详细的错误信息** - 自动生成清晰的失败消息
3. **类型安全** - 编译时类型检查
4. **扩展性** - 可以自定义断言
5. **与 Guava 集成** - 对 Google 集合类的良好支持

### 示例错误信息对比：

**JUnit 错误信息：**
```
Expected: [a, b, c]
Actual: [a, b, d]
```

**Truth 错误信息：**
```
Expected: [a, b, c]
But was : [a, b, d]
Element 2: expected <c> but was <d>
```

## 实际应用示例

```java
@Test
public void comprehensiveDequeTest() {
    Deque61B<Integer> deque = new LinkedListDeque61B<>();
    
    // 测试空队列
    assertThat(deque.isEmpty()).isTrue();
    assertThat(deque.size()).isEqualTo(0);
    
    // 添加元素
    deque.addFirst(1);
    deque.addLast(2);
    deque.addFirst(0);
    
    // 验证内容和顺序
    assertThat(deque.toList())
        .containsExactly(0, 1, 2)
        .inOrder();
    
    // 验证大小
    assertThat(deque.size()).isEqualTo(3);
    
    // 验证非空
    assertThat(deque.isEmpty()).isFalse();
    
    // 测试 get 方法
    assertThat(deque.get(0)).isEqualTo(0);
    assertThat(deque.get(1)).isEqualTo(1);
    assertThat(deque.get(2)).isEqualTo(2);
    
    // 测试越界访问
    assertThat(deque.get(3)).isNull();
    assertThat(deque.get(-1)).isNull();
}
```

## 总结

Google Truth 提供了：
- **更优雅的语法** - 流畅接口让测试代码更易读
- **更好的错误信息** - 帮助快速定位问题
- **丰富的断言方法** - 覆盖各种测试场景
- **类型安全** - 减少运行时错误
- **良好的扩展性** - 支持自定义断言

在你的测试中，Truth 可以让断言更加直观和易于维护，特别是在处理集合、字符串和复杂对象时。