# Git restore 文件恢复详解

## 你的问题的答案

**是的，完全正确！** 你的理解非常准确：

1. ✅ **只修改目标文件**：`git restore` 只会修改你指定的文件，其他所有文件保持不变
2. ✅ **算作新的修改**：恢复后的文件在工作区中显示为已修改状态，需要重新 `add` 和 `commit`

## 具体操作示例

假设你的项目结构：
```
project/
├── src/
│   ├── main.java    # 要恢复的文件
│   └── utils.java
├── README.md
└── config.json
```

### 查看提交历史
```bash
# 查看简化的提交历史
git log --oneline -- src/main.java

# 输出示例：
# a1b2c3d (HEAD) 添加新功能
# d4e5f6a 修复bug  
# e7f8g9h 优化性能
# x1y2z3a 初始提交  ← 我们要恢复到这个版本
```

### 执行恢复操作
```bash
# 恢复到最初提交的版本
git restore --source=x1y2z3a src/main.java
```

## 恢复后的状态

### 文件状态变化
```bash
# 恢复后查看状态
git status

# 输出示例：
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   src/main.java    # 只有这个文件被修改

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        # 其他文件都不会出现在这里
```

### 验证其他文件不受影响
```bash
# 检查其他文件的状态
git status --ignored
# 或者查看特定文件
git status src/utils.java README.md config.json
# 这些文件都会显示为 "nothing to commit, working tree clean"
```

## 重要特性说明

### 1. 精确的文件级操作
- `git restore` 只影响指定的文件
- 不会修改其他文件的状态
- 不会改变提交历史（HEAD 指针不变）

### 2. 工作区修改
- 恢复操作相当于用旧版本覆盖当前工作区的文件
- 这被视为一次文件修改，需要重新提交
- 恢复后的文件需要重新添加到暂存区

### 3. 后续操作
```bash
# 查看恢复后的差异
git diff src/main.java

# 添加到暂存区
git add src/main.java

# 提交恢复的版本
git commit -m "恢复 main.java 到初始版本"
```

## 与其他命令的对比

| 命令 | 影响范围 | 是否修改历史 | 需要重新提交 |
|------|----------|--------------|--------------|
| `git restore file` | 单个文件 | 否 | 是 |
| `git reset --hard` | 所有文件 | 是 | 否 |
| `git checkout commit` | 所有文件 | 是 | 否 |

## 实际应用场景

### 场景：恢复初始配置
```bash
# 不小心改坏了配置文件，想恢复到最初版本
git restore --source=初始提交hash config.properties

# 只影响这个配置文件，其他代码保持不变
```

### 场景：比较历史版本
```bash
# 先恢复到初始版本查看
git restore --source=x1y2z3a src/main.java

# 查看内容
cat src/main.java

# 如果需要，可以再恢复回来
git restore src/main.java  # 恢复到最新版本
```

## 注意事项

1. **备份重要修改**：恢复前确保没有重要未提交的修改
2. **确认 commit hash**：使用 `git log` 确认正确的初始提交ID
3. **测试功能**：恢复后测试相关功能是否正常
4. **及时提交**：恢复操作产生修改，记得及时提交避免丢失

## 总结

你的理解完全正确：`git restore --source=初始提交 file` 只会修改指定的单个文件，其他文件保持原状，并且这个恢复操作会被 Git 视为一次新的文件修改，需要重新添加到暂存区并提交。