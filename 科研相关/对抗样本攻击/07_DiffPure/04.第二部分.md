由于你已经看完了 **DDPM** 和 **DDIM**，这一部分对你来说会非常轻松。

**Section 2 (Background)** 的核心目的不是教你什么是扩散模型，而是 **“统一符号体系”**。

这篇论文没有使用 Ho et al. (DDPM) 的离散时间步符号（$t=1, \dots, 1000$），而是使用了宋杨（Yang Song）提出的 **Score-Based SDE（基于随机微分方程的分数生成模型）** 的连续时间框架。

搞懂这一节，是为了让你能看懂后面 Section 3 的数学推导（特别是那个 Adjoint Method）。

---

### 1. 从离散到连续（Discrete to Continuous）

你熟悉的 DDPM 是 discrete 的：
$$x_t = \sqrt{1-\beta_t} x_{t-1} + \sqrt{\beta_t} \epsilon$$

而在 DiffPure 中，作者把时间 $t$ 视为 $[0, 1]$ 之间的连续变量。当步数无限多时，离散的加噪过程就变成了一个 **SDE（随机微分方程）**。

### 2. 公式拆解（对接你的知识库）

请看着论文里的三个核心部分：

#### (1) Forward Process (前向过程, Eq. 1)
$$d\mathbf{x} = \mathbf{f}(\mathbf{x}, t)dt + g(t)d\mathbf{w}$$

*   **直觉**：这是 DDPM 加噪过程的连续版。
*   **$f(x, t)$ (漂移系数 Drift)**：控制数据均值的变化。在 **VP-SDE**（论文用的就是这个，等价于 DDPM）中，$f(x,t) = -\frac{1}{2}\beta(t)x$。这意味着随着时间推移，图像的像素值会逐渐衰减向 0 靠近。
*   **$g(t)$ (扩散系数 Diffusion)**：控制注入噪声的强度。对应 DDPM 里的 $\beta_t$。
*   **$d\mathbf{w}$**：就是布朗运动（标准高斯噪声）。

**这就解释了为什么图变模糊了**：信号在不断衰减（Drift），噪声在不断注入（Diffusion）。

#### (2) Reverse Process (反向过程, Eq. 2)
$$d\hat{\mathbf{x}} = [\mathbf{f}(\hat{\mathbf{x}}, t) - g(t)^2 \nabla_{\hat{\mathbf{x}}} \log p_t(\hat{\mathbf{x}})] dt + g(t) d\bar{\mathbf{w}}$$

*   **直觉**：这是 DDPM 降噪采样过程的连续版。
*   **关键项 $\nabla \log p_t(x)$**：这就是 **Score Function（分数函数）**。
    *   在 DDPM 里，模型预测的是噪声 $\epsilon_\theta$。
    *   在 Score SDE 里，模型预测的是这个 Score。
    *   **关系**：其实它俩是一回事，差一个常数倍数：$\nabla \log p_t(x) \approx - \frac{\epsilon_\theta(x, t)}{\sigma_t}$。
*   **物理意义**：Score 指向数据密度变大的方向。反向过程就是你是顺着梯度的指引，把原本乱跑的布朗运动给“拽”回到数据流形上。

#### (3) 训练目标 (Training)
论文简单提到了 **Denoising Score Matching (DSM)**。
*   这就对应 DDPM 里的 Loss Function（MSE Loss）。
*   我们的目标就是训练一个神经网络 $s_\theta(x, t)$ 来拟合那个真实的 Score $\nabla \log p_t(x)$。

---

### 3. 给你的“防坑”提示

在这一节中，有一个概念对复现 DiffPure 至关重要：**VP-SDE**。

*   论文提到：*"Throughout the paper, we consider VP-SDE as our diffusion model."*
*   **VP** 代表 **Variance Preserving**（方差保持）。这完全对应你学的标准 DDPM（Ho et al. 2020）。
*   还有一种叫 **VE-SDE**（Variance Exploding），对应宋杨早期的 NCSN 模型。
*   **复现注意**：在下载预训练模型代码库时（比如 `score_sde`），务必选择配置为 **VP** 的 checkpoint，不要选成 VE 了，否则公式里的系数会对不上。

### Summary of Section 2
这一节就把你的思维从“**第 t 步**”转换到了“**时间 t**”。
*   **Forward**: $x(0) \to x(1)$ (Data $\to$ Noise)
*   **Reverse**: $x(1) \to x(0)$ (Noise $\to$ Data)

这就为 Section 3 铺平了道路：DiffPure 的做法就是——我不走到终点 $t=1$，我只走到中间某个点 $t^*$ 就回头。因为是连续 SDE，所以这个 $t^*$ 可以取任意值（比如 0.14），非常灵活。

接下来我们进入最核心的 **Section 3 (Method)**。准备好了吗？