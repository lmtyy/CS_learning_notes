别担心，SDE（随机微分方程，Stochastic Differential Equation）是这篇文章最大的数学门槛，但既然你已经懂了 DDPM，我就能用大白话把你带进去。

你可以把 SDE 理解为：**DDPM 的“无限帧”版本**。

---

### 1. 直观理解：什么是 SDE？

我们先回到最简单的 **ODE（常微分方程）**。
*   比如你扔一个石头，忽略风阻，它的轨迹是确定的。
*   公式是：$dx = v \cdot dt$ （位置变化 = 速度 × 时间）。如果你知道现在的状态，你就能精确算出下一秒的状态。

但是，如果你是在**充满波涛的大海里**扔一个漂流瓶呢？
*   漂流瓶有一个主要的流向（比如洋流带它向东漂）—— 这是**确定的趋势**。
*   但海浪会不停地随机拍打它，让它左晃右晃 —— 这是**随机的噪声**。

**SDE 就是用来描述这种“既有规律，又有随机抖动”的过程的方程。**

$$ d\mathbf{x} = \underbrace{\mathbf{f}(\mathbf{x}, t) dt}_{\text{漂移 (Drift)}} + \underbrace{g(t) d\mathbf{w}}_{\text{扩散 (Diffusion)}} $$

*   **$d\mathbf{x}$**：图像 x 在极短时间内的微小变化。
*   **Drift（漂移项）**：代表那股“洋流”。在扩散模型里，它的作用通常是把图片的像素值慢慢缩小（衰减），让图片变得越来越像 0（全灰/全黑）。
*   **Diffusion（扩散项）**：代表那股“乱拍的海浪”。$d\mathbf{w}$ 是**布朗运动**（也就是每时每刻都在加纯高斯噪声）。这一项负责把随机噪声注入进图片里。

---

### 2. 它是怎么和 DDPM 连起来的？

你熟悉的 DDPM 是**离散**的（Discrete），比如 $T=1000$ 步。
公式长这样：
$$ x_t = \sqrt{1-\beta_t} x_{t-1} + \sqrt{\beta_t} \epsilon $$

如果我们把这 1000 步加密到 10000 步、1000000 步……直到步子无限小，**每一步的时间间隔从 $\Delta t$ 变成了 $dt$**，上面的离散公式就变成了 SDE。

*   **Forward SDE（加噪）**：就在描述一张清晰的图 $x(0)$，是如何在连续的时间里，一边像素值衰减（Drift），一边被高斯噪声淹没（Diffusion），最后在 $t=1$ 时变成纯噪声 $x(1)$ 的。

---

### 3. DiffPure 为什么要用 SDE 这种写法？

你可能会问：“我就用 DDPM 的 1000 步不行吗？为什么要搞这么复杂的微积分？”

这篇文章用 SDE 主要有三个好处：

1.  **时间的灵活性**：
    *   DDPM 只能说“第 50 步”。
    *   SDE 可以说“时间 $t=0.053$”。
    *   DiffPure 需要找一个**最佳净化点 $t^*$**。如果用离散步数，颗粒度可能太粗；用 SDE，我们可以精准控制噪声量。

2.  **统一的数学框架**：
    *   不管你是 DDPM（VP-SDE）还是 NCSN（VE-SDE），都可以写成 $dx = f dt + g dw$ 的形式。这样论文的理论推导（比如定理 3.1 证明 KL 散度下降）就更加通用，这就显得很帅（Paper 自带的高级感）。

3.  **Adjoint Method（最重要的一点！）**：
    *   为了算梯度。
    *   如果你用 DDPM 的 1000 层循环来写代码，反向传播要存 1000 份中间变量，显卡直接炸了。
    *   但是 SDE 是个微分方程。数学家发明了一种叫 **Adjoint Method** 的黑科技，使得我们不需要存中间状态，就像解另一个微分方程一样，把梯度“解”出来。**这只有在连续的 SDE 框架下才能通过数学推导成立。**

### 4. 总结

在读这篇论文时，看到 SDE 不要慌，你就脑补成：

*   **Forward SDE** = 只是步长无限小的加噪过程（把对抗扰动淹没掉）。
*   **Reverse SDE** = 只是步长无限小的去噪过程（把干净图像找回来）。
*   **Solver (sdeint)** = 就像你在 Python 里写 `for i in range(T)` 循环去噪一样，只不过这是一个封装好的、能处理连续时间的求解器。

现在能理解了吗？如果理解了，我们就可以进入最核心的 **Section 3**，看看它是怎么利用这个 SDE 来去除攻击的。