好的！在 `SELECT` 语句中使用算术操作是非常实用且强大的功能，它允许你直接对查询结果中的数值数据进行计算和转换。

### 一、什么是 SELECT 中的算术操作？

**算术操作允许你在查询数据的同时，对列值或字面量进行数学运算，并将计算结果作为新的列返回在结果集中。**

你可以把它想象成 Excel 中的公式。你不是简单地展示原始数据，而是**动态地计算并展示新的衍生数据**。

---

### 二、基本算术运算符

SQL 标准支持以下基本算术运算符，优先级与数学中相同（可通过括号 `()` 改变）：

| 运算符 | 描述 | 示例 | 结果 |
| :--- | :--- | :--- | :--- |
| `+` | 加法 | `SELECT 5 + 3;` | `8` |
| `-` | 减法 | `SELECT 10 - 4;` | `6` |
| `*` | 乘法 | `SELECT 6 * 7;` | `42` |
| `/` | 除法 | `SELECT 15 / 3;` | `5` |
| `%` | 取模（求余数） | `SELECT 11 % 4;` | `3` |

**注意**：并非所有数据库都使用 `%` 求模。**Oracle** 使用 `MOD()` 函数，而 **PostgreSQL** 和 **SQL Server** 同时支持 `%` 和 `MOD()`。

---

### 三、在 SELECT 中的使用方式

#### 1. 对字面量（常数）进行计算
主要用于快速测试或计算。
```sql
SELECT 10 + 5 AS Result; -- 结果：15
SELECT (20 * 3) - 5 AS Calculated_Value; -- 结果：55
```

#### 2. 对列进行计算（最常见）
这是最实用的场景，你可以对一列或多列的值进行运算。

**示例表：`Products`（产品表）**

| ProductID | ProductName | Price | Quantity | Cost |
| :--- | :--- | :--- | :--- | :--- |
| 1 | Apple | 5.00 | 10 | 3.00 |
| 2 | Banana | 3.50 | 20 | 2.00 |
| 3 | Orange | 4.20 | 15 | 2.50 |

**a) 单列运算：** 将所有商品价格提高10%
```sql
SELECT ProductName, Price, Price * 1.1 AS 'Increased Price'
FROM Products;
```
**结果：**
| ProductName | Price | Increased Price |
| :--- | :--- | :--- |
| Apple | 5.00 | 5.50 |
| Banana | 3.50 | 3.85 |
| Orange | 4.20 | 4.62 |

**b) 多列运算：** 计算每种商品的库存总价值（单价 × 数量）
```sql
SELECT ProductName, Price, Quantity, Price * Quantity AS 'Total Value'
FROM Products;
```
**结果：**
| ProductName | Price | Quantity | Total Value |
| :--- | :--- | :--- | :--- |
| Apple | 5.00 | 10 | 50.00 |
| Banana | 3.50 | 20 | 70.00 |
| Orange | 4.20 | 15 | 63.00 |

**c) 复杂运算：** 计算每种商品的毛利润和利润率
```sql
SELECT 
    ProductName,
    Price,
    Cost,
    (Price - Cost) * Quantity AS 'Total Profit', -- 总利润
    ROUND((Price - Cost) / Price * 100, 2) AS 'Profit Margin %' -- 利润率，保留两位小数
FROM Products;
```
**结果：**
| ProductName | Price | Cost | Total Profit | Profit Margin % |
| :--- | :--- | :--- | :--- | :--- |
| Apple | 5.00 | 3.00 | 20.00 | 40.00 |
| Banana | 3.50 | 2.00 | 30.00 | 42.86 |
| Orange | 4.20 | 2.50 | 25.50 | 40.48 |

---

### 四、结合 WHERE 和 ORDER BY 使用

你不仅可以在 `SELECT` 子句中显示计算结果，还可以在 `WHERE` 和 `ORDER BY` 子句中使用这些计算来过滤和排序。

#### 1. 在 WHERE 中过滤计算结果
**示例：** 找出总价值高于60元的商品。
```sql
SELECT ProductName, Price * Quantity AS TotalValue
FROM Products
WHERE (Price * Quantity) > 60
ORDER BY TotalValue DESC;
```
**注意**：在 `WHERE` 子句中，你不能使用在 `SELECT` 中定义的别名（如 `TotalValue`），因为 SQL 的执行顺序是 `FROM` -> `WHERE` -> `SELECT` -> `ORDER BY`。`WHERE` 执行时还不知道别名是什么。你必须重复计算表达式 `(Price * Quantity)` 或使用子查询。

#### 2. 在 ORDER BY 中按计算结果排序
**示例：** 按毛利润从高到低排列商品。
```sql
SELECT ProductName, Price, Cost, (Price - Cost) AS Profit
FROM Products
ORDER BY Profit DESC; -- 这里可以使用SELECT中定义的别名，因为ORDER BY在SELECT之后执行
```
**结果：**
| ProductName | Price | Cost | Profit |
| :--- | :--- | :--- | :--- |
| Banana | 3.50 | 2.00 | 1.50 |
| Orange | 4.20 | 2.50 | 1.70 |
| Apple | 5.00 | 3.00 | 2.00 |

---

### 五、处理 NULL 值

**这是一个至关重要的点！** 如果算术运算中的任何操作数为 `NULL`，那么整个表达式的结果通常也是 `NULL`。

```sql
-- 假设某产品的 Quantity 为 NULL
SELECT ProductName, Price * NULL AS Result FROM Products; -- 结果会是 NULL
```

**解决方法：使用 `COALESCE()` 或 `IFNULL()` 函数提供默认值。**
```sql
-- 将 NULL 数量视为 0 进行计算
SELECT 
    ProductName, 
    Price, 
    Quantity,
    Price * COALESCE(Quantity, 0) AS TotalValue -- 如果Quantity为NULL，则用0代替
FROM Products;

-- MySQL 中也可以用 IFNULL()
-- SELECT Price * IFNULL(Quantity, 0) AS TotalValue FROM Products;
```

---

### 六、常用数值函数

除了基本运算符，SQL 还提供了丰富的函数来处理数值计算：

| 函数 | 描述 | 示例 |
| :--- | :--- | :--- |
| `ROUND(number, decimals)` | 四舍五入到指定小数位 | `ROUND(123.4567, 2)` → `123.46` |
| `CEIL()` / `CEILING()` | 向上取整 | `CEIL(25.1)` → `26` |
| `FLOOR()` | 向下取整 | `FLOOR(25.9)` → `25` |
| `ABS()` | 绝对值 | `ABS(-10)` → `10` |
| `POWER(x, y)` | x 的 y 次幂 | `POWER(2, 3)` → `8` |
| `SQRT()` | 平方根 | `SQRT(9)` → `3` |
| `MOD(x, y)` | x 除以 y 的余数 | `MOD(11, 4)` → `3` |

**示例：**
```sql
SELECT 
    ProductName,
    Price,
    ROUND(Price * 0.9, 2) AS 'Discounted Price', -- 打9折并保留2位小数
    CEIL(Price) AS 'Ceiling Price',
    FLOOR(Price) AS 'Floor Price'
FROM Products;
```

### 总结

在 `SELECT` 中使用算术操作极大地增强了数据查询的灵活性和表现力。它允许你：
*   **动态创建新的衍生数据列**（如总价、利润、折扣价等）。
*   **直接在查询中进行业务逻辑计算**，减少应用程序层的代码。
*   **基于计算结果进行过滤和排序**。

**关键注意事项**：
1.  始终注意 `NULL` 值对计算的影响，并使用 `COALESCE()` 等函数处理。
2.  记住 SQL 的执行顺序，理解为何在 `WHERE` 中不能使用 `SELECT` 的别名。
3.  不同数据库在函数名（如求模）和精度处理上可能有细微差别。