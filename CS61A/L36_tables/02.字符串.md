好的！SQL 中的字符串处理是非常强大且常用的功能。它允许你操作、格式化和分析文本数据。我们来详细讲解一下。

### 一、字符串字面量（表示字符串）

在 SQL 中，字符串由单引号 `' '` 括起来。

```sql
SELECT 'Hello, World!' AS Greeting;
-- 结果： Hello, World!
```

**重要**：大多数 SQL 数据库使用**单引号**表示字符串。双引号 `" "` 通常用于引用标识符（如表名、列名，如果它们包含空格或特殊字符）。
```sql
-- 正确
SELECT 'This is a string';

-- 在大多数数据库中错误（除非设置了ANSI_QUOTES模式）
SELECT "This is a string";

-- 双引号的正确用法：引用包含空格的列别名
SELECT FirstName AS "First Name" FROM Employees;
```

---

### 二、字符串连接（拼接）

将多个字符串合并成一个。这是最常用的操作之一，但**语法因数据库而异**。

| 数据库 | 运算符/函数 | 示例 |
| :--- | :--- | :--- |
| **SQL Server** | `+` | `SELECT 'Hello' + ' ' + 'World';` |
| **Oracle, PostgreSQL** | `||` (管道符) | `SELECT 'Hello' || ' ' || 'World';` |
| **MySQL** | `CONCAT()` 函数 | `SELECT CONCAT('Hello', ' ', 'World');` |
| **标准SQL** | `||` | `SELECT 'Hello' || ' ' || 'World';` |

**实际示例**：将名字和姓氏组合成全名。
```sql
-- MySQL
SELECT CONCAT(FirstName, ' ', LastName) AS FullName FROM Employees;

-- Oracle/PostgreSQL/SQL Server（2012+也支持CONCAT）
SELECT FirstName || ' ' || LastName AS FullName FROM Employees;

-- SQL Server
SELECT FirstName + ' ' + LastName AS FullName FROM Employees;
```

**处理 NULL 值**：如果连接的任何一个部分是 NULL，整个结果可能变成 NULL。使用 `COALESCE()` 或 `IFNULL()` 来避免。
```sql
-- 如果MiddleName为NULL，则将其视为空字符串
SELECT CONCAT(FirstName, ' ', COALESCE(MiddleName, ''), ' ', LastName) AS FullName
FROM Employees;
```

---

### 三、常用字符串函数

以下函数在绝大多数数据库中都存在（函数名可能略有不同）。

#### 1. 长度相关
*   `LENGTH(string)` 或 `LEN(string)`：返回字符串的字符数。
    ```sql
    SELECT LENGTH('Hello'); -- 结果：5
    SELECT LEN('Hello');    -- SQL Server 使用 LEN
    ```

#### 2. 大小写转换
*   `UPPER(string)`：将字符串转换为大写。
*   `LOWER(string)`：将字符串转换为小写。
    ```sql
    SELECT UPPER('hello'); -- 结果：HELLO
    SELECT LOWER('HELLO'); -- 结果：hello
    ```

#### 3. 提取子字符串
*   `SUBSTRING(string, start, length)` 或 `SUBSTR(string, start, length)`：从字符串中提取一部分。
    *   `start`：开始位置（**通常从1开始计数**，不是0！）
    *   `length`：要提取的字符数（可选的，如果省略则提取到末尾）

    ```sql
    SELECT SUBSTRING('Hello World', 1, 5); -- 结果：'Hello'
    SELECT SUBSTRING('Hello World', 7);    -- 结果：'World' (从第7位到末尾)
    ```

#### 4. 修剪空格
*   `TRIM(string)`：去除字符串**首尾**的所有空格。
*   `LTRIM(string)`：仅去除字符串**开头**的空格。
*   `RTRIM(string)`：仅去除字符串**末尾**的空格。

    ```sql
    SELECT TRIM('   Hello   '); -- 结果：'Hello'
    SELECT LTRIM('   Hello   '); -- 结果：'Hello   '
    SELECT RTRIM('   Hello   '); -- 结果：'   Hello'
    ```

#### 5. 查找与替换
*   `POSITION(substring IN string)` 或 `CHARINDEX(substring, string)`：返回子字符串在父字符串中第一次出现的位置（**从1开始**，如果没找到则返回0）。
    ```sql
    -- 标准语法
    SELECT POSITION('lo' IN 'Hello'); -- 结果：4 (因为'l'在第4位)
    -- SQL Server 语法
    SELECT CHARINDEX('lo', 'Hello'); -- 结果：4
    ```

*   `REPLACE(string, old_substring, new_substring)`：替换字符串中的所有匹配项。
    ```sql
    SELECT REPLACE('Hello World', 'World', 'SQL'); -- 结果：'Hello SQL'
    ```

---

### 四、模式匹配：`LIKE` 操作符

`LIKE` 用于在 `WHERE` 子句中搜索列中的指定模式。它使用两个通配符：
*   `%`：代表零个、一个或多个字符。
*   `_`：代表一个单一的字符。

**示例：**
```sql
-- 查找所有以 '张' 开头的姓
SELECT * FROM Customers WHERE LastName LIKE '张%';

-- 查找所有以 '国' 结尾的国家
SELECT * FROM Countries WHERE CountryName LIKE '%国';

-- 查找包含 '科技' 的公司名
SELECT * FROM Companies WHERE CompanyName LIKE '%科技%';

-- 查找第二个字符是 '明' 的名字（例如：李明、王明）
SELECT * FROM Users WHERE Name LIKE '_明%';

-- 查找精确长度为3个字符的名字
SELECT * FROM Users WHERE Name LIKE '___';
```

**转义通配符**：如果你需要搜索包含 `%` 或 `_` 的字符串，需要使用 `ESCAPE` 关键字。
```sql
-- 查找包含 '20%' 的折扣信息
SELECT * FROM Discounts WHERE Description LIKE '%20!%%' ESCAPE '!';
-- 这里的 '!' 被定义为转义字符，'!%' 表示普通的百分号
```

---

### 五、高级字符串函数（部分数据库支持）

*   `LEFT(string, n)` / `RIGHT(string, n)`：返回字符串左/右起的 n 个字符。
    ```sql
    SELECT LEFT('Hello World', 5); -- 结果：'Hello'
    SELECT RIGHT('Hello World', 5); -- 结果：'World'
    ```

*   `REVERSE(string)`：反转字符串。
    ```sql
    SELECT REVERSE('Hello'); -- 结果：'olleH'
    ```

*   `REPEAT(string, n)` 或 `REPLICATE(string, n)`：重复字符串 n 次。
    ```sql
    SELECT REPEAT('Ha', 3); -- 结果：'HaHaHa' (MySQL)
    SELECT REPLICATE('Ha', 3); -- 结果：'HaHaHa' (SQL Server)
    ```

---

### 六、综合应用示例

**场景**：格式化用户信息，邮箱用户名转为大写，并提取域名。
```sql
SELECT
    UserID,
    -- 原始邮箱
    Email,
    -- 提取@之前的用户名部分并转为大写
    UPPER(SUBSTRING(Email, 1, POSITION('@' IN Email) - 1)) AS Username,
    -- 提取@之后的域名部分
    SUBSTRING(Email, POSITION('@' IN Email) + 1) AS Domain,
    -- 创建格式化的显示名: "FirstName F. LastName" (例如: "John D. Doe")
    CONCAT(
        FirstName, 
        ' ', 
        SUBSTRING(MiddleName, 1, 1), -- 取中间名首字母
        '. ', 
        LastName
    ) AS DisplayName
FROM Users;
```

### 总结

SQL 的字符串功能非常丰富，可以让你：
1.  **操作文本**：拼接、截取、修剪、替换。
2.  **转换格式**：改变大小写。
3.  **搜索模式**：使用 `LIKE` 进行灵活查询。
4.  **清理数据**：处理不一致的输入（如多余空格、大小写混合）。

**关键点**：
*   始终注意数据库之间的**语法差异**（尤其是连接操作符）。
*   小心处理 **NULL 值**，它们会使字符串操作的结果变为 NULL。
*   **字符串位置通常从 1 开始**，而不是 0。

掌握这些字符串操作技巧，你就能有效地处理和转换数据库中的任何文本数据。