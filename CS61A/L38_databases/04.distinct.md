好的！`DISTINCT` 是 SQL 中一个非常实用且简单的关键字，用于去除查询结果中的重复行。我来为你详细讲解它的用法。

### 一、DISTINCT 是什么？

`DISTINCT` 关键字用于从 SELECT 语句的结果集中**去除重复的行**，只返回唯一的记录。

**核心思想**：就像数学中的集合一样，每个元素只出现一次。

---

### 二、基本语法

#### 1. 去除单列的重复值
```sql
SELECT DISTINCT column_name 
FROM table_name;
```

#### 2. 去除多列的重复值
```sql
SELECT DISTINCT column1, column2, column3
FROM table_name;
```

---

### 三、使用示例

假设我们有一个 `employees` 表：

| id | name | department | city |
|----|------|------------|------|
| 1 | 张三 | 技术部 | 北京 |
| 2 | 李四 | 销售部 | 上海 |
| 3 | 王五 | 技术部 | 北京 |
| 4 | 赵六 | 人力资源 | 广州 |
| 5 | 孙七 | 销售部 | 上海 |

#### 示例1：获取所有不同的部门
```sql
SELECT DISTINCT department FROM employees;
```

**结果：**
```
department
---
技术部
销售部
人力资源
```

#### 示例2：获取不同的部门和城市组合
```sql
SELECT DISTINCT department, city FROM employees;
```

**结果：**
```
department   | city
------------ | -----
技术部       | 北京
销售部       | 上海
人力资源     | 广州
```

注意：虽然"技术部-北京"和"销售部-上海"都有多个员工，但每个组合只出现一次。

---

### 四、DISTINCT 与 SELECT 的位置关系

`DISTINCT` 必须紧跟在 `SELECT` 之后：

```sql
-- ✅ 正确
SELECT DISTINCT department, city FROM employees;

-- ❌ 错误
SELECT department, DISTINCT city FROM employees;
```

---

### 五、DISTINCT 与聚合函数

`DISTINCT` 可以与聚合函数结合使用，只对不同的值进行计算。

#### 示例数据：`sales` 表

| sale_id | product | amount |
|---------|---------|--------|
| 1 | 手机 | 1000 |
| 2 | 电脑 | 2000 |
| 3 | 手机 | 1000 |
| 4 | 平板 | 1500 |
| 5 | 手机 | 1200 |

#### 示例1：计算不同产品的数量
```sql
SELECT COUNT(DISTINCT product) AS unique_products FROM sales;
```

**结果：** `3`（手机、电脑、平板）

#### 示例2：计算不同产品的总销售额
```sql
SELECT SUM(DISTINCT amount) AS unique_amounts_sum FROM sales;
```

**结果：** `1000 + 2000 + 1500 + 1200 = 5700`

**对比：** 如果不加 DISTINCT：
```sql
SELECT SUM(amount) FROM sales;  -- 结果：6700
```

---

### 六、DISTINCT 与 ORDER BY

`DISTINCT` 可以和 `ORDER BY` 一起使用，但要注意：

```sql
SELECT DISTINCT department, city
FROM employees
ORDER BY department, city;
```

**⚠️ 注意**：`ORDER BY` 中的列必须在 `SELECT` 中出现，或者可以使用聚合函数。

---

### 七、DISTINCT 与 NULL 值

`DISTINCT` 将所有的 `NULL` 值视为相同的值，因此多个 `NULL` 只会返回一个。

#### 示例数据：`customers` 表

| id | name | phone |
|----|------|-------|
| 1 | 张三 | 12345 |
| 2 | 李四 | NULL |
| 3 | 王五 | 67890 |
| 4 | 赵六 | NULL |

```sql
SELECT DISTINCT phone FROM customers;
```

**结果：**
```
phone
---
12345
NULL
67890
```

---

### 八、DISTINCT vs GROUP BY

`DISTINCT` 和 `GROUP BY` 都可以去除重复，但它们的目的不同：

#### 使用 DISTINCT
```sql
SELECT DISTINCT department, city FROM employees;
```
**目的**：只想要唯一的部门-城市组合

#### 使用 GROUP BY
```sql
SELECT department, city, COUNT(*) AS employee_count
FROM employees
GROUP BY department, city;
```
**目的**：想要唯一的组合，并且想知道每个组合有多少员工

**结果对比：**

**DISTINCT 结果：**
```
department   | city
------------ | -----
技术部       | 北京
销售部       | 上海
人力资源     | 广州
```

**GROUP BY 结果：**
```
department   | city | employee_count
------------ | -----| --------------
技术部       | 北京 | 2
销售部       | 上海 | 2
人力资源     | 广州 | 1
```

---

### 九、性能考虑

1. **大数据集**：在大型表上使用 `DISTINCT` 可能会比较慢，因为它需要对结果进行排序和去重。

2. **索引帮助**：如果对 `DISTINCT` 使用的列有索引，可以显著提高性能。

3. **替代方案**：有时候使用 `GROUP BY` 可能比 `DISTINCT` 更高效，特别是在需要聚合计算时。

---

### 十、实用技巧

#### 1. 找出有重复值的列
```sql
-- 找出有重复邮箱的用户
SELECT email, COUNT(*)
FROM users
GROUP BY email
HAVING COUNT(*) > 1;
```

#### 2. 多列去重时选择需要显示的列
```sql
-- 获取每个部门-城市组合的第一个员工名字
SELECT DISTINCT 
    department, 
    city,
    FIRST_VALUE(name) OVER (PARTITION BY department, city ORDER BY id) AS first_employee
FROM employees;
```

---

### 总结

`DISTINCT` 关键字的要点：

1. **用途**：去除查询结果中的重复行
2. **语法**：`SELECT DISTINCT column1, column2, ...`
3. **多列**：基于所有指定列的组合来判断是否重复
4. **与聚合函数**：可以结合使用，如 `COUNT(DISTINCT column)`
5. **NULL 处理**：将所有 NULL 视为相同的值
6. **性能**：在大数据集上可能较慢，考虑使用索引

**使用场景**：
- 获取唯一的值列表
- 数据清洗时查看不同的值
- 与聚合函数结合计算唯一值的数量

**记住**：`DISTINCT` 查看的是整行的唯一性，而不是单个列的唯一性。