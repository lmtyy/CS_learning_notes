好的！Python 内置的 `sqlite3` 库是一个轻量级、无需额外安装的数据库操作工具，非常适合初学者学习和小型项目使用。

### 一、什么是 sqlite3？

`sqlite3` 是 Python 的标准库模块，用于操作 **SQLite 数据库**。SQLite 是一个嵌入式数据库，整个数据库就是一个文件，不需要单独的服务器进程。

**特点：**
- ✅ 无需安装，Python 内置
- ✅ 零配置，开箱即用
- ✅ 单个文件数据库，便于移植
- ✅ 适合开发、测试和小型项目
- ❌ 不适合高并发大型应用

---

### 二、基本使用流程

使用 `sqlite3` 的基本流程遵循"连接→游标→执行→提交→关闭"的模式。

#### 1. 连接数据库
```python
import sqlite3

# 连接数据库（如果不存在会自动创建）
conn = sqlite3.connect('example.db')

# 内存数据库（临时使用）
# conn = sqlite3.connect(':memory:')
```

#### 2. 创建游标对象
```python
# 创建游标，用于执行SQL语句
cursor = conn.cursor()
```

#### 3. 执行SQL语句
```python
# 创建表
cursor.execute('''
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        age INTEGER,
        email TEXT UNIQUE
    )
''')

# 插入数据
cursor.execute("INSERT INTO users (name, age, email) VALUES (?, ?, ?)", 
               ('张三', 25, 'zhangsan@email.com'))

# 查询数据
cursor.execute("SELECT * FROM users WHERE age > ?", (20,))
```

#### 4. 提交和关闭
```python
# 提交事务（增删改操作需要提交）
conn.commit()

# 关闭连接
conn.close()
```

---

### 三、核心API详解

#### 1. 连接对象（Connection）
```python
conn = sqlite3.connect('test.db')

# 常用方法：
conn.commit()      # 提交事务
conn.rollback()    # 回滚事务
conn.close()       # 关闭连接
conn.cursor()      # 创建游标

# 设置为Row对象，可以通过列名访问数据
conn.row_factory = sqlite3.Row
```

#### 2. 游标对象（Cursor）
```python
cursor = conn.cursor()

# 执行SQL语句
cursor.execute(sql[, parameters])

# 执行多条SQL语句
cursor.executemany(sql, sequence_of_parameters)

# 获取所有结果
cursor.fetchall()

# 获取一条结果
cursor.fetchone()

# 获取多条结果
cursor.fetchmany(size)

# 获取最后插入的ID
last_id = cursor.lastrowid
```

---

### 四、数据操作示例

#### 1. 增（INSERT）
```python
# 单条插入
cursor.execute(
    "INSERT INTO users (name, age, email) VALUES (?, ?, ?)",
    ('李四', 30, 'lisi@example.com')
)

# 批量插入
users = [
    ('王五', 28, 'wangwu@example.com'),
    ('赵六', 35, 'zhaoliu@example.com')
]
cursor.executemany(
    "INSERT INTO users (name, age, email) VALUES (?, ?, ?)",
    users
)
conn.commit()
```

#### 2. 删（DELETE）
```python
cursor.execute(
    "DELETE FROM users WHERE id = ?",
    (5,)
)
conn.commit()
```

#### 3. 改（UPDATE）
```python
cursor.execute(
    "UPDATE users SET age = ? WHERE name = ?",
    (26, '张三')
)
conn.commit()
```

#### 4. 查（SELECT）
```python
# 查询所有数据
cursor.execute("SELECT * FROM users")
rows = cursor.fetchall()
for row in rows:
    print(row)  # 元组形式: (1, '张三', 25, 'zhangsan@email.com')

# 使用Row对象（可以通过列名访问）
conn.row_factory = sqlite3.Row
cursor = conn.cursor()
cursor.execute("SELECT * FROM users")
rows = cursor.fetchall()
for row in rows:
    print(row['name'], row['age'])  # 通过列名访问
```

---

### 五、参数化查询（防止SQL注入）

**永远不要**用字符串拼接，**一定要**用参数化查询：

```python
# ❌ 危险！SQL注入风险
name = "张三'; DROP TABLE users; --"
cursor.execute(f"SELECT * FROM users WHERE name = '{name}'")

# ✅ 安全！参数化查询
name = "张三'; DROP TABLE users; --"
cursor.execute("SELECT * FROM users WHERE name = ?", (name,))

# 多个参数
cursor.execute(
    "SELECT * FROM users WHERE age > ? AND name LIKE ?",
    (20, '张%')
)
```

---

### 六、使用上下文管理器（推荐）

使用 `with` 语句可以自动处理连接关闭和事务提交：

```python
# 自动提交和关闭连接
with sqlite3.connect('example.db') as conn:
    cursor = conn.cursor()
    cursor.execute("INSERT INTO users (name) VALUES (?)", ('测试用户',))
    # 不需要手动调用 conn.commit()

# 或者更完整的写法
with sqlite3.connect('example.db') as conn:
    with conn:  # 自动事务管理
        cursor = conn.cursor()
        cursor.execute("INSERT ...")
        # 成功自动提交，异常自动回滚
```

---

### 七、实用技巧

#### 1. 获取字典形式的结果
```python
def dict_factory(cursor, row):
    d = {}
    for idx, col in enumerate(cursor.description):
        d[col[0]] = row[idx]
    return d

conn.row_factory = dict_factory
cursor = conn.cursor()
cursor.execute("SELECT * FROM users")
for row in cursor.fetchall():
    print(row['name'])  # 像字典一样访问
```

#### 2. 错误处理
```python
try:
    with sqlite3.connect('example.db') as conn:
        cursor = conn.cursor()
        cursor.execute("INSERT ...")
except sqlite3.Error as e:
    print(f"数据库错误: {e}")
```

#### 3. 查看表信息
```python
# 获取所有表名
cursor.execute("SELECT name FROM sqlite_master WHERE type='table'")
tables = cursor.fetchall()
print(tables)

# 查看表结构
cursor.execute("PRAGMA table_info(users)")
columns = cursor.fetchall()
for col in columns:
    print(col[1], col[2])  # 列名和数据类型
```

---

### 八、完整示例

```python
import sqlite3

def main():
    # 连接数据库
    with sqlite3.connect('school.db') as conn:
        conn.row_factory = sqlite3.Row
        
        # 创建表
        conn.execute('''
            CREATE TABLE IF NOT EXISTS students (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                grade INTEGER,
                class TEXT
            )
        ''')
        
        # 插入数据
        with conn:
            conn.executemany(
                "INSERT INTO students (name, grade, class) VALUES (?, ?, ?)",
                [
                    ('小明', 90, 'A'),
                    ('小红', 85, 'B'),
                    ('小刚', 92, 'A')
                ]
            )
        
        # 查询数据
        cursor = conn.cursor()
        cursor.execute(
            "SELECT * FROM students WHERE grade > ? AND class = ?",
            (85, 'A')
        )
        
        print("成绩大于85分的A班学生:")
        for row in cursor.fetchall():
            print(f"{row['name']}: {row['grade']}分")

if __name__ == "__main__":
    main()
```

### 总结

Python 的 `sqlite3` 库：
- **简单易用**：API 直观，学习成本低
- **功能完整**：支持完整的 SQL 语法和事务管理
- **安全可靠**：支持参数化查询，防止 SQL 注入
- **适合场景**：小型项目、原型开发、测试、数据分析

记住最佳实践：
1. **总是**使用参数化查询
2. **使用**上下文管理器（`with` 语句）
3. **适当**使用事务（`conn.commit()`）
4. **及时**关闭连接（或使用 `with` 自动关闭）

对于初学者和小型项目，`sqlite3` 是一个完美的数据库选择！