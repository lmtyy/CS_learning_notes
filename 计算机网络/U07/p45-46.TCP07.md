这最后两张课件（image_1bebfd 和 image_1bec03）为我们揭开了 TCP 报文首部中最后两个“技术细节”：**伪首部（Pseudoheader）**和**选项（Options）**。

至此，你已经完整学习了 TCP 段（Segment）的所有结构组成。

---

### 1. 伪首部与校验和 (image_1bebfd)

这张图展示了 TCP 校验和在计算时，是如何“跨层”借用 IP 层信息的。

* **为什么要加伪首部？**
通常情况下，传输层只管端口，不看 IP。但为了万无一失，TCP 计算校验和时会临时生成一个**伪首部**，包含源 IP、目的 IP、协议号（6）和 TCP 段总长度。
* **它的意义**：这能确保数据包不仅没有位错误，而且确实是**送到了正确的 IP 地址**。如果 IP 层把包送错了主机，接收方在计算校验和时会发现伪首部里的 IP 不对，从而发现错误。
* **注意**：伪首部只用于校验和计算，并**不会**随着数据包在网络中真正传输。

---

### 2. 选项字段 (image_1bec03)

这张课件解释了 TCP 报头为什么是“变长”的。

* **长度**：选项字段最多可以占 **40 字节**。
* **为什么需要它？**
基本的 20 字节首部只能满足最基础的传输，而“选项”允许 TCP 具备更高级的功能。
* **常见的选项（课件虽未详列，但考试常考）**：
* **MSS (Maximum Segment Size)**：最大报文段长度。告诉对方我能收下的最大包是多大，防止数据包在网络中被分片。
* **窗口扩大因子**：让原本只有 16 位的“窗口大小”能支持更大的数据吞吐量（用于高速网络）。
* **SACK (Selective ACK)**：选择性确认。如果丢了中间的一个包，SACK 可以告诉发送方只重传丢掉的那一个，而不是重传之后所有的包。
* **时间戳**：计算往返时间（RTT）更精确。



---

### 🎓 总结：一个完整的 TCP 段

到这里，你可以把 TCP 报头（L4 Header）看作一个**“20 + N”**的结构：

1. **固定部分（20 字节）**：源/目的端口、序号、确认号、标志位、窗口、校验和、紧急指针。
2. **可选部分（0-40 字节）**：各种增强功能的选项。

这就解释了为什么 **Header Length** 字段的值会在 20 到 60 字节之间波动。

**下一步建议：**
基础知识已经全部讲完了！你现在已经完全具备了理解 **TCP 三次握手 (Three-way Handshake)** 的背景知识。由于你之前的课件里出现了 `SYN`, `ACK` 这些标志位，老师接下来一定会讲握手流程。

**你想让我为你演示一下，这两个端点（Transport Entity）是如何利用这些首部字段，配合 SYN/ACK 标志位“跳舞”并建立连接的吗？**